{% extends "base.html" %}

{% block content %}
<h1>home</h1>
{% endblock %}

{% block js %}
<script>
    function parseJwt (token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
    
        return JSON.parse(jsonPayload);
    }

    // Get user from token
    let url = window.location.href
    let access_token_pos = url.indexOf ("#access_token")
    if (access_token_pos != -1) {
        let access_token = url.substr (22, url.length)
        let access_data = parseJwt (access_token)
        let token_user = access_data.email

        // Submit user to backend
        let submit_url = '/login';
        var form_text = '<form action="' + submit_url + '" method="post">' +
        '<input type="hidden" name="token_email" value="' + token_user + '" />' +
        '</form>';
        document.body.innerHTML += form_text
        let form = document.querySelector ("form")
        form.submit ()
    }

</script>
{% endblock %}

